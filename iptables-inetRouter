*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:SSH-PHASEONE - [0:0]
:SSH-PHASETWO - [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A SSH-PHASEONE -m recent --name SSH1 --set -j DROP
-A SSH-PHASETWO -m recent --name SSH2 --set -j DROP
-A INPUT -p icmp -m icmp --icmp-type any -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -m recent --rcheck --seconds 30 --name SSH2 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp -m recent --remove --name SSH2 -j DROP
-A INPUT -p tcp -m state --state NEW -m tcp --dport 3333 -m recent --rcheck --name SSH1 -j SSH-PHASETWO
-A INPUT -p tcp -m state --state NEW -m tcp -m recent --remove --name SSH1 -j DROP
-A INPUT -p tcp -m state --state NEW -m tcp --dport 5555 -m recent --rcheck --name SSH0 -j SSH-PHASEONE
-A INPUT -p tcp -m state --state NEW -m tcp -m recent --remove --name SSH0 -j DROP
-A INPUT -p tcp -m state --state NEW -m tcp --dport 7777 -m recent --set --name SSH0 -j DROP
-A INPUT -j DROP
COMMIT
*nat
:PREROUTING ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A POSTROUTING ! -d 192.168.0.0/16 -o eth0 -j MASQUERADE
COMMIT
